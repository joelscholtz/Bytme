@model List<bytme.Models.ShoppingCartModel>

@{
}
<script>
    function UpdateQtyOrder(ordline_id, new_qty) {

        $.ajax({
            type: "POST",
            data: {
                orderline_id: ordline_id,
                qty: new_qty
            },

            url: "/ShoppingCart/UpdateQuantityInShoppingCart",
            success: function (response) {
                document.body.innerHTML = response;
            },
            error: function () {
                return "error";
            }
        });
    }
</script>

<script language="javascript">
    function testForEnter() {
        if (event.keyCode == 13) {
            event.cancelBubble = true;
            event.returnValue = false;
        }
    }
</script>

<h2>Your Shoppingcart</h2>

<div class="container">
    <form method="post" id="form-ShoppingCart">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <table id="cart" class="table table-hover table-condensed">
            <thead>
                <tr>
                    <th style="width:30%">Product</th>
                    <th style="width:10%">Amount</th>
                    <th style="width:20%">Price</th>
                    <th style="width:20%" class="text-center">Subtotal</th>
                    <th style="width:10%"></th>
                </tr>
            </thead>
            <tbody>
                @if (ViewBag.model_view != null)
                {
                    @for (int i = 0; i < Model.Count(); i++)
                    {
                        <tr>
                            <td data-th="Products">
                                <div class="row" style="margin-left:0px">
                                    <div class="=col-sm-2 hidden-xs"><img src="@Html.DisplayFor(model => model[i].photo_url)" style="width:200px;height:300px" /></div>
                                    <div class="col-sm-10">
                                        <h4 class="nomargin">@Html.DisplayFor(model => model[i].description)</h4>
                                        <p>@Html.DisplayFor(model => model[i].long_description)</p>
                                    </div>
                                </div>
                            </td>

                            <script>
                            function checkGreaterStock(qty, which) {
                                if (qty > @Model[i].stock) {
                                    document.getElementById("_data_qty_" + which).value = @Model[i].stock;
                                }
                                else if (qty < 1) {
                                    document.getElementById("_data_qty_" + which).value = 1;
                                }
                            }
                            </script>

                            <td data-th="Quantity">
                                <input asp-for="@Model[i].qty" type="number" min="1" max="@Html.DisplayFor(model => model[i].stock)" id="_data_qty_@Model[i].orderline_id" onkeydown="testForEnter();" onchange="UpdateQtyOrder(@Model[i].orderline_id , this.value)" class="form-control" value="@Model[i].qty" oninput="checkGreaterStock(this.value, @Model[i].orderline_id)" required>

                            <td data-th="Price">&euro; @{ var price = (Model[i].price); } @{ @price.ToString("N")}</td>

                            <td data-th="Subtotal" class="text-center"><span id="_data_subtotal_@Model[i].orderline_id"> &euro;  @{var total = (@Model[i].price * @Model[i].qty); } @{ @total.ToString("N") } </span></td>
                            <td class="actions" data-th="">
                            <td>
                                <a href='@Url.Action("DeleteItemFromShoppingCart", "ShoppingCart", new { orderline_id = Model[i].orderline_id })' class="btn btn-danger btn-block">Remove product</a>
                            </td>

                        </tr>
                    }
                }
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2" class="hidden-xs"></td>
                    @if (ViewBag.model_view != null)
                    {
                        @if (ViewBag.totalPrice < 100)
                        {
                            <td class="hidden-xs text-center"><h5>if you buy €100,- or more your shipping costs will be free </h5></td>
                            <td colspan="2" class="hidden-xs text-center"><h5>shipping costs = €2.95</h5> <h4><strong>Total = &euro;@ViewBag.totalPrice.ToString("0.00")</strong></h4></td>
                        }
                        @if (ViewBag.totalPrice >= 100)
                        {
                            <td colspan="5" class="hidden-xs text-center"><h4><strong><span id="result_sub_total">Total &euro;@ViewBag.totalPrice.ToString("N")</span></strong></h4></td>
                        }
                    }
                </tr>
                <tr>
                    <td colspan="5" class="hidden-xs"></td>
                    @if(ViewBag.count > 0 )
                    {
                    <td style="margin-left:50%"><button type="submit" class="btn btn-success btn-block">Check out</button></td>
                    }
                </tr>
            </tfoot>
        </table>

        @if (ViewBag.count == 0)
        {
            <center>
                <h1>
                    <span>Your shoppingcart is empty</span>
                </h1>
            </center>
        }
    </form>
</div>