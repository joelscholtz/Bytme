@model List<bytme.Models.ShoppingCartModel>

@{
}
<script>
    function UpdateQtyOrder(ordline_id, new_qty) {

        $.ajax({
            type: "POST",
            data: {
                orderline_id: ordline_id,
                qty: new_qty
            },

            url: "/ShoppingCart/UpdateQuantityInShoppingCart",
            success: function (response) {
                document.body.innerHTML = response;
            },
            error: function () {
                return "error";
            }
        });
    }
</script>
<h2>Your Shoppingcart</h2>

<div class="container">
    <form method="post" id="form-ShoppingCart">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <table id="cart" class="table table-hover table-condensed">
                <thead>
                    <tr>
                        <th style="width:50%">Product</th>
                        <th style="width:10%">Amount</th>
                        <th style="width:10%">Price</th>
                        <th style="width:10%" class="text-center">Subtotal</th>
                        <th style="width:10%"></th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewBag.model_view != null)
                    {
                        @for(int i=0; i < Model.Count(); i++)
                        {
                    <tr>
                        <td data-th="Products">
                            <div class="row" style="margin-left:0px">
                                <div class="=col-sm-2 hidden-xs"><img src="@Html.DisplayFor(model => model[i].photo_url)" style="width:200px;height:300px" /></div>
                                <div class="col-sm-10">
                                    <h4 class="nomargin">@Html.DisplayFor(model => model[i].description)</h4>
                                    <p>@Html.DisplayFor(model => model[i].long_description)</p>
                                </div>
                            </div>
                        </td>

                        <td data-th="Quantity">
                            <input asp-for="@Model[i].qty" type="number" min="1" max="@Html.DisplayFor(model => model[i].stock)" id="_data_qty_@Model[i].orderline_id" onchange="UpdateQtyOrder(@Model[i].orderline_id , this.value)" class="form-control" value="@Model[i].qty">
                            @Html.HiddenFor(x => Model[i].orderline_id)
                            @Html.HiddenFor(x => Model[i].order_id)
                            @Html.HiddenFor(x => Model[i].item_id)
                        </td>

                        <td data-th="Price">&euro;@Html.DisplayFor(model => model[i].price) </td>
                        <td data-th="Subtotal" class="text-center"><span id="_data_subtotal_@Model[i].orderline_id"> &euro;  @{var total = (@Model[i].price * @Model[i].qty); } @{ @total }  </span></td>
                        <td class="actions" data-th="">
                        <td>
                            <a href='@Url.Action("DeleteItemFromShoppingCart", "ShoppingCart", new { orderline_id = Model[i].orderline_id })' class="btn btn-danger btn-block">Remove product</a>
                        </td>

                    </tr>
                        }
                    }
                </tbody>
            </table> 
            @if(ViewBag.count == 0)
            {
            <center>
                <h1>
                    <span>Your shoppingcart is empty</span>
                </h1>
            </center>
            }
    </form>
</div>